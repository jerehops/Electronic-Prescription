{% extends 'base.html' %}

{% block content %}
<div class="container mb-4">
  <div class="row">
    <div class="col-8" id="contents">
      <div id="greeting" class="alert alert-primary my-2" role="alert">
        <p>
          <big>
            Hello Doctor {{ current_user.fName }}
          </big>
        </p>
      </div>

      <div class="row my-4">
        <div class="col">
          <div class="card m-1">
            <div class="card-body" id="total-presc">
              <!-- Total Prescriptions -->
              <h5 class="text-primary">{{ total_issued }}</h5>
              <small class="text-secondary">prescriptions issued</small>
            </div>
          </div>
        </div>

        <div class="col">
          <div class="card m-1">
            <div class="card-body" id="monthly-presc">
              <!-- Monthly Prescriptions -->
              <h5 class="text-primary">{{ monthly_issued }}</h5>
              <small class="text-secondary">prescriptions this month</small>
            </div>
          </div>
        </div>

        <div class="col">
          <div class="card m-1">
            <div class="card-body" id="active-presc">
              <!-- active prescription -->
              <h5 class="text-primary">{{ active_presc }}</h5>
              <small class="text-secondary">active prescriptions currently</small>
            </div>
          </div>
        </div>
      </div>

      <h5 class="my-2">
        <small class="text-muted">Prescriptions Status</small>
      </h5>

      {% for p in issued_prescriptions %}

      <div class="card my-2">
        <div class="card-body card-btn d-flex justify-content-between align-items-center"
          onclick="viewPrescription(this)"
          data-pres-id="{{ p['pres_id'] }}">
          <div>
            <strong class="text-secondary">{{ p["p_name"] }}</strong><br>
            <small>prescribed from {{ p["from_date"] }}</small>
          </div>
          <div>
            <small class="text-muted">{{ p['meds_count'] }} medicines</small>
          </div>
          <div class="">
            {% if p['status'] == 'active' %}
            <span class="badge bg-success">{{ p['status'] }}</span>
            {% else %}
            <span class="badge bg-secondary">{{ p['status'] }}</span>
            {% endif %}
          </div>
        </div>
      </div>
      <script type="text/javascript">
        function viewPrescription(node) {
          const pres_id = node.dataset.presId;
          window.location = `/prescription/${pres_id}`
        }
      </script>

      {% endfor %}

    </div>
    <!-- 2nd column -->
    <div class="col-4">
      <div class="card m-3">
        <div
          class="card-body d-flex flex-column justify-content-center p-2"
        >
          <a class="btn btn-danger mx-auto my-2 w-50" href="{{ url_for('prescription.create_get_prescriptions') }}">
            Create Prescription
          </a>
          <a class="btn btn-primary mx-auto my-2 w-50">
            Edit My Profile
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
